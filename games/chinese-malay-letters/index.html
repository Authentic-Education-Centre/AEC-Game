<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ¯ ä¸­æ–‡é©¬æ¥æ–‡å­—æ¯æ¸¸æˆ - AEC</title>
    <style>
        body {
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .game-area {
            width: 800px;
            height: 400px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            margin: 20px auto;
            position: relative;
            border: 3px solid white;
            border-radius: 20px;
            overflow: hidden;
        }
        
        .falling-letter {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            border: 3px solid rgba(255,255,255,0.8);
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
        }
        
        .chinese-word {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            padding: 20px;
            border-radius: 20px;
            margin: 20px auto;
            max-width: 400px;
        }
        
        .built-word {
            font-size: 2rem;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 400px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .message {
            font-size: 1.2rem;
            margin: 20px;
            padding: 10px;
            border-radius: 10px;
        }
        
        .success { background: rgba(76, 175, 80, 0.8); }
        .error { background: rgba(244, 67, 54, 0.8); }
        
        @media (max-width: 768px) {
            .game-area { width: 95vw; height: 350px; }
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ ä¸­æ–‡é©¬æ¥æ–‡å­—æ¯æ¸¸æˆ</h1>
    
    <div class="chinese-word" id="chinese-word">äº¤é€šå·¥å…·</div>
    
    <div class="game-area" id="game-area"></div>
    
    <div class="built-word" id="built-word">å‡†å¤‡å¼€å§‹...</div>
    
    <div class="message" id="message">ğŸ”Š ç‚¹å‡»å¼€å§‹æŒ‰é’®å¼€å§‹æ¸¸æˆï¼</div>
    
    <div>
        <button onclick="startGame()">ğŸ”Š å¼€å§‹æ¸¸æˆ</button>
        <button onclick="resetGame()">ğŸ”„ é‡ç½®</button>
        <button onclick="nextWord()" id="next-btn" disabled>â¡ï¸ ä¸‹ä¸€å…³</button>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const wordPairs = [
            { chinese: 'äº¤é€šå·¥å…·', malay: 'kenderaan' },
            { chinese: 'çŠ¶å†µ', malay: 'situasi' },
            { chinese: 'å®‰å…¨å¸¦', malay: 'tali pinggang keledar' },
            { chinese: 'å‡ºå‘', malay: 'bertolak' },
            { chinese: 'æ ‡ç­¾', malay: 'label' }
        ];

        // æ¸¸æˆçŠ¶æ€
        let currentWordIndex = 0;
        let targetWord = 'kenderaan';
        let builtWord = '';
        let gameState = 'ready';
        let gameInterval = null;
        let wordCompleted = false;

        console.log('æ¸¸æˆåˆå§‹åŒ–...');

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = '') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = 'message ' + type;
            console.log('æ¶ˆæ¯:', text);
        }

        // è¯­éŸ³æ’­æ”¾
        function speakChinese(text) {
            console.log('æ’­æ”¾ä¸­æ–‡:', text);
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.7;
                speechSynthesis.speak(utterance);
                showMessage('ğŸ”Š æ­£åœ¨æ’­æ”¾ä¸­æ–‡å‘éŸ³...', 'success');
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            console.log('=== å¼€å§‹æ¸¸æˆ ===');
            
            if (gameState === 'playing') {
                console.log('æ¸¸æˆå·²åœ¨è¿›è¡Œä¸­');
                return;
            }
            
            gameState = 'playing';
            builtWord = '';
            wordCompleted = false;
            document.getElementById('built-word').textContent = '';
            document.getElementById('next-btn').disabled = true;
            
            const currentPair = wordPairs[currentWordIndex];
            targetWord = currentPair.malay;
            
            console.log('ç›®æ ‡å•è¯:', targetWord);
            
            speakChinese(currentPair.chinese);
            showMessage('ç‚¹å‡»æ‰è½çš„å­—æ¯æ¥æ‹¼å‡ºé©¬æ¥æ–‡å•è¯ï¼', 'success');
            
            // æ¸…ç†æ—§å­—æ¯
            document.getElementById('game-area').innerHTML = '';
            
            // å¼€å§‹ç”Ÿæˆå­—æ¯
            if (gameInterval) {
                clearInterval(gameInterval);
            }
            
            console.log('å¼€å§‹ç”Ÿæˆå­—æ¯...');
            gameInterval = setInterval(createLetter, 800);
        }

        // åˆ›å»ºæ‰è½å­—æ¯
        function createLetter() {
            if (gameState !== 'playing') return;
            
            console.log('åˆ›å»ºå­—æ¯');
            
            const gameArea = document.getElementById('game-area');
            const letter = getRandomLetter();
            
            const letterEl = document.createElement('div');
            letterEl.className = 'falling-letter';
            letterEl.textContent = letter;
            letterEl.style.left = Math.random() * (gameArea.offsetWidth - 50) + 'px';
            letterEl.style.top = '0px';
            
            // ç‚¹å‡»äº‹ä»¶
            letterEl.onclick = () => handleLetterClick(letter, letterEl);
            
            gameArea.appendChild(letterEl);
            console.log('å­—æ¯å·²æ·»åŠ :', letter);
            
            // æ‰è½åŠ¨ç”» - ç¨å¾®æ…¢ä¸€ç‚¹
            let top = 0;
            const fall = setInterval(() => {
                top += 1.5;
                letterEl.style.top = top + 'px';
                
                if (top > 350) {
                    letterEl.remove();
                    clearInterval(fall);
                }
            }, 20);
        }

        // è·å–éšæœºå­—æ¯
        function getRandomLetter() {
            const nextNeededLetter = targetWord[builtWord.length];
            const allLetters = 'abcdefghijklmnopqrstuvwxyz ';
            
            // 70%å‡ ç‡ç»™å‡ºæ­£ç¡®å­—æ¯
            if (Math.random() < 0.7 && nextNeededLetter) {
                return nextNeededLetter;
            } else {
                return allLetters[Math.floor(Math.random() * allLetters.length)];
            }
        }

        // å¤„ç†å­—æ¯ç‚¹å‡»
        function handleLetterClick(letter, letterEl) {
            const nextNeededLetter = targetWord[builtWord.length];
            console.log('ç‚¹å‡»å­—æ¯:', letter, 'éœ€è¦:', nextNeededLetter);
            
            if (letter === nextNeededLetter) {
                // æ­£ç¡®
                builtWord += letter;
                letterEl.remove();
                showMessage('ğŸ‰ æ­£ç¡®ï¼', 'success');
                updateDisplay();
                
                // æ£€æŸ¥å®Œæˆ
                if (builtWord === targetWord) {
                    wordCompleted = true;
                    gameState = 'completed';
                    clearInterval(gameInterval);
                    document.getElementById('next-btn').disabled = false;
                    showMessage('ğŸ† å®Œæˆäº†ï¼å•è¯: ' + targetWord, 'success');
                    console.log('å•è¯å®Œæˆï¼');
                }
            } else {
                // é”™è¯¯
                letterEl.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
                setTimeout(() => letterEl.remove(), 500);
                showMessage('âŒ é”™è¯¯ï¼', 'error');
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('built-word').textContent = builtWord || 'å‡†å¤‡å¼€å§‹...';
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            console.log('é‡ç½®æ¸¸æˆ');
            gameState = 'ready';
            builtWord = '';
            wordCompleted = false;
            
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            document.getElementById('game-area').innerHTML = '';
            document.getElementById('next-btn').disabled = true;
            updateDisplay();
            showMessage('ğŸ® ç‚¹å‡»å¼€å§‹æŒ‰é’®å¼€å§‹æ¸¸æˆï¼');
        }

        // ä¸‹ä¸€å…³
        function nextWord() {
            if (!wordCompleted) {
                showMessage('âŒ è¯·å…ˆå®Œæˆå½“å‰å•è¯æ‰èƒ½è¿›å…¥ä¸‹ä¸€å…³ï¼', 'error');
                return;
            }
            
            console.log('ä¸‹ä¸€å…³');
            if (currentWordIndex < wordPairs.length - 1) {
                currentWordIndex++;
            } else {
                currentWordIndex = 0;
            }
            
            const currentPair = wordPairs[currentWordIndex];
            document.getElementById('chinese-word').textContent = currentPair.chinese;
            targetWord = currentPair.malay;
            
            // è‡ªåŠ¨å¼€å§‹æ–°ä¸€å…³
            setTimeout(() => {
                startGame();
            }, 1000); // 1ç§’åè‡ªåŠ¨å¼€å§‹
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            updateDisplay();
            
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
            }
        });

        console.log('JavaScriptåŠ è½½å®Œæˆ');
    </script>
</body>
</html>